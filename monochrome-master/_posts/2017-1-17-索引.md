## 索引的概念 ##

1.什么是索引?

index 中文有索引的意思

我们看的英文书,在目录部分,就写有index

数据库帮我们存储数据,存储在文件里,我们之前也看到了那个文件

MYD文件帮我存数据,当我们取数据的时候,我们希望取得比较快

那如何能让数据取的比较快呢?

当数据越来越多,MYD文件则越来越大

假设有 10000 行的数据

select .. where id=10000

那它应该迅速就来到文件的第10000行,取出这个数据

那它如何知道,这个第10000行,是在这个MYD文件中的第一个字节开始取呢?就是说,沿着这个文件,我们走多少字节,才能到第10000行呢

怎么样才能快速帮我们查到呢,这个时候就需要靠索引了

MYI 是索引文件

索引文件是干什么的?

它里面也是存储的数据,只不过它这个数据,是通过某种数据结构

帮你高效索引起来的

比如说它存储一个树形结构的,找起数据来就非常快速

索引是数据的目录,能快速定位行数据的位置

如果我们增加一行数据,删除一行数据,或者更改一行数据,

是不是索引也需要相应的操作呢?

因此:

索引提高了查询速度,降低了增删改的速度,并非加的越多越好

在实际中,有可能一张表的索引文件,比这张表的数据文件还要大 => 目录比书还厚

一般在查询频繁的列上加,而且在重复度低列上加效果更好

2.索引的类型

mysql中 有以下几种索引

1)key, 普通索引

纯粹就是帮我们组织数据,提高查询速度

2)unique key, 唯一索引

起到2个作用

1)是加快你的查询速度

2)是帮你约束数据,怎么个约束法?

这个数据不可能重复了,unique 中文 唯一的意思

3)primary key , 主键索引

一张表中,只可能有一个 primary key

4)fulltext 全文索引

注意:

中文环境下,全文索引无效

为什么呢?

因为英文,每个单词是分开的,它将每个单词分为别类,建立索引

你查这行中的任意一个单词,都有可能查询到这行数据

而中文的每个字是连在一起的,它无法区分每个字

所以就导致,在中文环境下,全文索引是无效的

在中文环境下,需要 分词+索引才有效

一般用第三方解决方案,如sphinx


5)设置索引长度

设置索引长度是为了优化索引

建索引时,可以只定索引列的前一部分的内容

例:

email列 后面都都是 @qq.com,@163.com, 等

@后面的内容区分度不高,都是类似的内容

那我们可不可以

将 @ 前的10个字符内容给截取下来建索引 -> 可以

    create table t24 (
    name char(10),
    email char(20),
    key name(name),
    unique key email(email(10))
    );

注意:

这个并不是限制的email长度,只能填10个字符

而是索引只取10个字符

插入大于 10个字符 长度的email

6)多列索引

有的时候,一列索引还查询不出来什么效果

多列索引,就是把2列或多列的值,看成一个整体,然后建索引

例:

我们注册国外网站的会员时,会让我们分别注册

firstname,lastname 姓和名

分开存姓名,可以方便以后查询不同姓氏的注册用户

但大部分使用还是将姓名连接在一起查询的

6)多列索引

有的时候,一列索引还查询不出来什么效果

多列索引,就是把2列或多列的值,看成一个整体,然后建索引

例:

我们注册国外网站的会员时,会让我们分别注册

firstname,lastname 姓和名

分开存姓名,可以方便以后查询不同姓氏的注册用户

但大部分使用还是将姓名连接在一起查询的

    create table t25 (
    xing char(10),
    ming char(10),
    key xm(xing,ming)
    );

    insert into t25 values ('zhang','san');
    desc t25;

查看表的详细索引信息

    show index from t25;

注意:

以下两个select 多列索引是可以发挥作用的

    select * from t25 where xing='zhang' and ming='san';
    select * from t25 where xing='zhang';

下面这个select 索引是不能发挥作用的

    select * from t25 where ming='san';


例:

一片文章,有标题,有内容

标题:<<静夜思>>为索引 -> 对应的内容 在第9页

1是我们看到内容在第九页,就去第9也看内容了

2是我们找到index索引标题,而不去看它的内容

从索引直接返回数据,不用走MYD文件去查询

怎样区分它是否能使用上索引呢?

左前缀

一个数据,从左到右 abcdefg..

我们给书建目录,目录是有顺序的

我们们前半部分能记得 abcd..后面记不得了,它可以帮我们定位大致的范围

那如果前面记不住,后面记得 ...efg ,那如何定位

前面的数据千变万化 有可能是zzzzefg,或这aaaaefg 等,根据右半部分无法定位

这个就是健使用的左前缀规则,从左往右侧查,索引还能部分发挥作用,左侧是确定的,相对好查询
右侧固定,左侧不知道,那则是千变万化,无法使用索引

7)冗余索引

就是在某个列上,可能存在多个索引

比如 xm(xing,ming) 我们单查ming,索引不发挥作用

ming(ming) 给ming也加上索引,单独查ming的时候,也是有索引发挥作用的,那如果 xing和ming都查,对于ming则会后两个索引发挥作用

在开发中,为了提高查询速度,我们也经常会用到冗余索引

    create table t26 (
    xing char(10),
    ming char(10),
    key xm(xing,ming),
    key ming(ming)
    );
    

## 索引操作 ##

1.查看一张表的索引

show index from 表名

show create table 表名 查看建表语句,后面也会显示索引

2.删除索引

删除哪张表的哪个索引?

删除 alter table 表名 drop index 索引名

或 drop index 索引名 on 表名

3.添加索引

alter table 表名 add index/unique xm(xing,ming);

4.添加主键索引,不需要起名字,因为是唯一的

alter tables 表名 add primary key(id[主键名称]);

5.删除主键索引

alter table 表名 drop primary key;
