**cookie与session**

无论是什么变量,在php中是无法跨越到另一个页面的

那如何像会员登录一样,每个页面都可以获取这个变量

需要用cookie

cookie是浏览器在和它配合,共同达到这样一个效果

http原理的角度来说:

浏览器一敲回车,访问一个页面,这是个请求.且会带着一些我们人眼无法直观的东西去请求

网卡沿着网线连接到服务器的网卡上,打开了它的80端口,双方建立了一个这样的连接,就像一个通道一样

apache -> 开始相应,响应你登陆成功,同时会响应一些我们眼睛无法直观看到的东西,暗号,把admin这个暗号给了我们的浏览器.

浏览器拿到这个暗号,会将它存起来.

请求->相应 ,这次请求彻底结束,他俩的连接网卡就这样断开了,不再有任何关系

下次,浏览器再去请求其他的页面,此时,浏览器会带着暗号,admin过去连接apache

**cookie计数器**

第一次刷新显示1,

第2,3,4...n次刷新显示n

第一次 浏览器 -> apache (给浏览器一个cookie)

第二次 浏览器 (带着cookie) -> apache (更改浏览器的cookie)

setcookie函数里讲到:

Once the cookies have been set, they can be accessed on the next page load with the $_COOKIE

如果setcookie ,$_COOKIE想获取cookie的值,需要在下一次请求中才可以访问到

    if( !isset($_COOKIE['num']) ) {
    $num = 1; //事先给一个临时cookie值
    setcookie('num' , $num);
    } else {
    $num = $_COOKIE['num'] + 1;
    setcookie('num' , $num);
    }
    echo $num;


**cookie详细操作语法**

cookie的有效期,几秒后结束

setcookie的第3个参数,表示cookie的声明周期,需要用时间戳来表示

    setcookie('sec' , '!!!' , time()+10);

如果不加第3个参数,表示关闭浏览器就失效

setcookie的第4个参数,代表cookie的有效路径

cookie默认是在当前目录下有效,如果是这样,大型的网站无法做到全站登录

cookie,可以往下级目录识别,往上级目录跳没办法

第5个参数,不常用,cookie是不能跨域的,可以在不同的子域名中生效

大的网站,往往有很多子域名,如果让cookie 在不同的子域名中生效

book.163.com mil.163.com lady.163.com

指定到确定的位置去取出cookie

    setcookie('test2' , '666' , time()+60 , '/' , '163.com');


**登录与退出功能**

登录 -> 验证用户名密码是否正确 -> 登陆后apache给浏览器一个唯一的cookie

从cookie的角度看

登录 -> 就是设置cookie的过程

退出 -> 就是销毁cookie的过程

表单 post-> 提交到php -> 查询用户名,密码是否正确 -> 正确则setcookie

在login.php中

    <?php 
    require('./lib/init.php');
    
    if (empty($_POST)) {
    	require(ROOT.'/view/front/login.html');
    }else{
    	$user['name']=trim($_POST['name']);
    	if (empty($user['name'])) {
    		error('用户名不能为空');
    	}
    
    	$user['password']=trim($_POST['password']);
    	if (empty($user['password'])) {
    		error('密码不能为空')；
    	}
    
    	$sql="select *from user where name='$user[name]' and
    	password='$user[password]'";
    	if (!mGetRow($sql)) {
    		error('用户名或者密码错误');
    	}else{
    		setcookie('name',$user['name']);
    		header('Location:artlist.php');
    	}
    }
    
     ?>


在func.php中检测一下是否有权限登录

    /*检测用户是否登录*/
    
    function acc(){
    	return isset($_COOKIE['name']);
    }

在artlist.php中检测是否登录

    if (!acc()) {
    	//没有登录就跳转到登录页面
    	header('Location:login.php');
    }

退出也需要用到setcookie

不论是设置,修改,销毁cookie,都需要用到setcookie

    <?php 
    
    setcookie('name',null,0);
    header('Location:login.php');
     ?>

在artlist.php中添加

    <li><a href="logout.php">退出登陆</a></li>


**session原理**

1.重要的信息放在哪里?

服务器端

2.浏览器拿箱子的号,是用什么记住这个号的,每次来访问服务器用什么带着这个号来的?

cookie

所以说,cookie和session是有联系的

无论是设置,读取,销毁session,需要先开启session

    session_start();

开启session之后,可以直接写session变量

    session_start();
    $_SESSION['area'] = 'beijing';


**session语法细节**

1.session无论是读取,修改,销毁 都要先session_start();

2.session的读取,修改,销毁,可以直接操作$_SESSION数组

3.session销毁

1)$_SESSION = array();

2)session_destroy();

销毁更彻底,彻底删除session文件

4.session的配置

在php.ini搜索"session",可找到相关配置项

**session与cookie的比较**

![](http://i.imgur.com/avDzIfJ.jpg)

一个域名下最多可设置多少个cookie?

浏览器对cookie数量和大小有限制的！

根据各个浏览器的设置不同，所以储存的cookie个数会不同

Internet Explorer允许cookie最长为4095个字符。 

Firefox和Safari允许cookie最长为4097个字符，即cookie的名（name）和值（value）总共可以长达4096个字符。

Opera则允许cookie最长为4096个字符。

浏览器禁用了cookie,还可不可以使用session?

1)cookie是用来传箱子上的号码的,禁用cookie,小票无法传递,session不能使用;

2)但有一种非常不安全的方法：通过url get方式，这样打开浏览器上的地址栏就会直接显示session密码


